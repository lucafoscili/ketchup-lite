name: Publish Candidate - Publish on Candidate Update

on:
    push:
        branches:
            - candidate

jobs:
    publish-candidate:
        runs-on: ubuntu-latest
        steps:
            - name: Checkout Repository
              uses: actions/checkout@v4

            - name: Set Up Node.js
              uses: actions/setup-node@v4
              with:
                  node-version: '18.x'
                  registry-url: 'https://registry.npmjs.org'

            - name: Install Dependencies
              run: yarn install --no-immutable

            - name: Build Packages
              run: yarn build

            - name: Publish Packages to NPM
              run: |
                  PACKAGES=("ketchup-lite" "ketchup-lite-react" "ketchup-lite-react-ssr" "ketchup-lite-hydrate")
                  for pkg in "${PACKAGES[@]}"; do
                    echo "Publishing ${pkg}"
                    cd packages/${pkg}
                    npm publish --tag rc
                    cd ../../
                  done
              env:
                  NODE_AUTH_TOKEN: ${{ secrets.NPM_TOKEN }}
